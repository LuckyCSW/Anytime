<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.naver.anytime.mybatis.mapper.PostMapper">

	<select id="getDetail" parameterType="int" resultType="post">
		select POST_ID, BOARD_ID, USER_ID, SUBJECT, CONTENT, POST_FILE, 
			   TO_CHAR(POST_DATE,'MM/DD HH24:MI') as POST_DATE,
               LIKE_COUNT, SCRAP_COUNT, REPORT_COUNT, STATUS
        from post
        where POST_ID = #{post_id}
	</select>

	<select id="getListCount" resultType="int">
		select count(*) from post
		where board_id = #{board_id}
	</select>
	
	<select id="getPostList" parameterType="map" resultType="post">
   		SELECT * 
    	FROM (
      	  SELECT ROWNUM RNUM, j.*
      	  FROM (
        	    SELECT post.*, NVL(cnt, 0) AS comment_count
        	    FROM post
        	    LEFT OUTER JOIN (
        	        SELECT post_id, COUNT(*) cnt
        	        FROM comments
        	        GROUP BY post_id
       	     ) sub_C
       	     ON post.post_id = sub_C.post_id
            	WHERE post.board_id = #{board_id}
            	ORDER BY post.post_id DESC
        	) j 
        	WHERE ROWNUM &lt;= #{end} 
    	) 
    	WHERE RNUM &gt;= #{start} AND RNUM &lt;= #{end}
	</select>
	
	<select id="getUserNickname" parameterType="int" resultType="post">
    	SELECT user_id, nickname
    	FROM member
	</select>
	
	
	
</mapper>