<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.naver.anytime.mybatis.mapper.BoardMapper">

	<select id="getBoardName" resultType="board">
		select name,content from board
		where board_id = #{board_id}
	</select>

	<select id="getBoardList" resultType="board">
		select * from board
		where school_id = #{school_id}
	</select>
	
	<select id="getBoardDetail" parameterType="int" resultType="board">
		select *
		from board
		where BOARD_ID = #{board_id}
	</select>
	
	<select id="getBoardAnonymous" resultType="int">
		select anonymous
		from board
		where board_id = #{board_id}
	</select>
	
	<select id="getBoardIds" parameterType="String" resultType="int">
		SELECT BOARD_ID
        FROM BOARD
        WHERE TYPE = 1
        AND SCHOOL_ID = (	select school_id 
        					from member 
        					where login_id =#{member_id}
        				)
        AND STATUS = 1
        AND NAME != '공지사항'
	</select>
	
	<select id="getBoardIdsByDomain" parameterType="String" resultType="int">
		SELECT BOARD_ID
        FROM BOARD
        WHERE TYPE = 1
        AND SCHOOL_ID = (	select school_id 
        					from school 
        					where domain =#{school_domain}
        				)
        AND STATUS = 1
        AND NAME != '공지사항'
	</select>
	
	<select id="getBoardContent" resultType="String">
		select content
		from board
		where board_id = #{board_id}
	</select>
	
	<update id="updateBoardContent" parameterType="map">
	    UPDATE board
	    SET content = #{content}
	    WHERE board_id = #{board_id}
	</update>
	
	<select id="getboardManager" resultType="int">
		select *
		from board
		where board_id = ${board_id} and user_id = ${user_id}
	</select>

	<insert id="insertBoard" parameterType="Board">
	<selectKey keyProperty="NEW_BOARD_ID" resultType="int" order="AFTER">
		SELECT BOARD_SEQ.CURRVAL FROM DUAL
	</selectKey>
		INSERT INTO BOARD
				(BOARD_ID, SCHOOL_ID, USER_ID,
				TYPE, NAME, CONTENT, ANONYMOUS,
				STATUS, PURPOSE)
		VALUES (BOARD_SEQ.NEXTVAL, #{SCHOOL_ID}, #{USER_ID},
				#{TYPE}, #{NAME}, #{CONTENT}, #{ANONYMOUS},
				#{STATUS}, #{PURPOSE})
	</insert>

</mapper>
